<data inherit_id="purchase.report_purchaseorder_document">
    <xpath expr="//t[@t-call='web.external_layout']" position="replace">
        <div class="page">
            <div class="oe_structure"/>
            <div id="client_copy">
                  
            <table style="width: 100% !important; border: 0px">
                <tbody style="border: 0px">
                  <tr style="border: 0px">
                    <td class="text_right mt-4" style="width:90%;">
                     
                      <strong><span t-field="o.partner_id.name"/></strong> <br/>
                      <span t-field="o.partner_id.country_id"/> <br/>
                      <br/>
                    </td>
                    <td/>
                    <td/>
                    <td/>
                    <td name="td_date" class="text_end">
                      <strong class="text_end">Date: <span t-esc="o.date_order.strftime('%d-%m-%Y')"/></strong> <br/>
                      <br/>
                    </td>
                  </tr>
                </tbody>
              </table>
              
            <table class="table table-sm mt-4">
                <thead style="display: table-row-group">
                    <tr>
                        <th name="th_si" class="text-center"><strong>#</strong></th>
                        <th name="th_gross_weight" class="text-center"><strong>Qty <br/>(GMS)</strong></th>
                        <th name="th_product_qty" class="text-center"><strong>Qty <br/>(Tolas)</strong></th>
                        <th name="th_x_factor" class="text-center"><strong>Tola <br/> Rate</strong></th>
                        <th name="th_product_quality" class="text-center"><strong>Purity <br/>%</strong></th>
                        <th name="th_price_subtotal" class="text-center"><strong>USD <br/> $</strong></th>
                    </tr>
                </thead>
              <tbody>
    <t t-foreach="enumerate(o.order_line, 1)" t-as="line">
        <tr t-att-class="'bg-200 fw-bold o_line_section' if line[1].display_type == 'line_section' else 'fst-italic o_line_note' if line[1].display_type == 'line_note' else ''">
            <t t-if="not line[1].display_type">
                <!-- Only display the line if either product_quality or manual_product_quality is greater than 0 -->
                <t t-if="line[1].product_quality &gt; 0 or line[1].manual_product_quality &gt; 0">
                    <td id="product" class="text-center">
                        <span t-esc="line[0]"/>
                    </td>
                    <t t-if="line[1].manual_first_process &gt; 0">
                        <td id="product" class="text-center">
                            <span t-field="line[1].manual_first_process"/>
                        </td>
                    </t>
                    <t t-if="line[1].manual_first_process == 0">
                        <td id="product" class="text-center">
                            <span t-field="line[1].first_process_wt"/>
                        </td>
                    </t>
                    <td id="product" class="text-center">
                        <span t-field="line[1].product_qty"/>
                    </td>
                    <td id="product" class="text-center">
                        <span t-field="o.transaction_price_per_unit"/>
                    </td>
                    <t t-if="line[1].manual_product_quality &gt; 0">
                        <td id="product" class="text-center">
                            <span t-field="line[1].manual_product_quality"/>
                        </td>
                    </t>
                    <t t-if="line[1].manual_product_quality == 0">
                        <td id="product" class="text-center">
                            <span t-field="line[1].product_quality"/>
                        </td>
                    </t>
                    <td class="text-center">
                        <span t-field="line[1].price_subtotal"/>
                    </td>
                </t>
            </t>
            <t t-else="">
                <td colspan="99" id="section">
                    <span t-field="line[1].name"/>
                </td>
            </t>
        </tr>
    </t>
</tbody>

            </table>
        <table style="width: 100% !important; border: 0px">
            <tbody style="border: 0px">
                <!-- Calculate the total subtotal in UGX -->
                <t t-set="total_custom_currency" t-value="sum(line.currency_id._convert(line.price_subtotal, line.UGX_currency, o.company_id, o.date_order or fields.Date.today()) for line in o.order_line if (line.product_quality &gt; 0 or line.manual_product_quality &gt; 0))"/>
        
                <!-- Calculate the total subtotal in USD -->
                <t t-set="total_usd" t-value="sum(line.price_subtotal for line in o.order_line if (line.product_quality &gt; 0 or line.manual_product_quality &gt; 0))"/>
                
                <!-- Display the totals -->
                <tr style="border: 0px">
                    <td class="text_right" style="width: 65% !important; line-height: 30px; margin: 0px !important; border: 0px !important;">
                        <span>Total</span>
                    </td>
                    <td name="td_amount_untaxed" class="text_end" style="margin: 0px !important; line-height: 30px; width: 15% !important; border: 0px !important;">
                        <span>
                            USD <span style="padding-left:40px;"><t t-esc="total_usd" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/></span>
                        </span>
                        <br/>
                        <span>
                            UGX <span style="padding-left:40px;"><t t-esc="total_custom_currency" t-options="{'widget': 'monetary', 'display_currency': o.currency_id, 'precision': 0}"/></span>
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>


            </div>
           
                      <!--Company Copy-->
            <div id="company_copy" class="mt-5">
               <table style="width: 100% !important; border: 0px">
                <tbody style="border: 0px">
                  <tr style="border: 0px">
                    <td class="text_right" style="width:90%;">
                     
                      <span t-field="o.partner_id.name"/> <br/>
                      <span t-field="o.partner_id.country_id"/> <br/>
                      <br/>
                    </td>
                    <td/>
                    <td/>
                    <td/>
  
                    <td name="td_date" class="text_right">
                      <strong>Date: <span t-esc="o.date_order.strftime('%d-%m-%Y')"/></strong> <br/>
                      <strong>PO: #<span t-field="o.name"/></strong> <br/>
                      <br/>
                    </td>
                  </tr>
                </tbody>
              </table>

            <table class="table table-sm mt-4">
                <thead style="display: table-row-group">
                    <tr>
                        <th name="th_product"><strong>Item</strong></th>
                        <th name="th_gross_weight"><strong>Grams</strong></th>
                        <th name="th_product_qty"><strong>Tolas</strong></th>
                        <th name="th_x_factor"><strong>Rate</strong></th>
                        <th name="th_product_quality"><strong>Purity%</strong></th>
                        <th name="th_price_subtotal" class="text-end"><strong>Subtotal</strong></th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="o.order_line" t-as="order_line">
                        <tr t-att-class="'bg-200 fw-bold o_line_section' if order_line.display_type == 'line_section' else 'fst-italic o_line_note' if order_line.display_type == 'line_note' else ''">
                            <t t-if="not order_line.display_type">
                                <td id="product">
                                    <span t-field="order_line.name"/>
                                </td>
                                
                                 <t t-if="order_line.manual_first_process &gt; 0">
                                        <td id="product">
                                        <span t-field="order_line.manual_first_process"/>
                                    </td>
                                    </t>
                                    <t t-if="order_line.manual_first_process == 0">
                                        <td id="product">
                                      <span t-field="order_line.first_process_wt"/>
                                    </td>
                                    </t>
                                 <td id="product">
                                     <span t-field="order_line.product_qty"/>
                                </td>
                                <td id="product">
                                    <span t-field="o.transaction_price_per_unit"/>
                                </td>
                                
                                <t t-if="order_line.manual_product_quality &gt; 0">
                                        <td id="product">
                                        <span t-field="order_line.manual_product_quality"/>
                                    </td>
                                    </t>
                                <t t-if="order_line.manual_product_quality == 0">
                                        <td id="product">
                                      <span t-field="order_line.product_quality"/>
                                    </td>
                                    </t>
                                <td class="text-end">
                                   
                                    <span t-field="order_line.price_subtotal"/>
                                </td>
                            </t>
                            <t t-else="">
                                <td colspan="99" id="section">
                                    <span t-field="order_line.name"/>
                                </td>
                            </t>
                        </tr>
                    </t>
                </tbody>
            </table>
              
            </div>
  

            <p t-field="o.notes" class="mt-4"/>

            <div class="oe_structure"/>
        </div>
    </xpath>

</data>