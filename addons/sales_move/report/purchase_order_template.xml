<data inherit_id="purchase.report_purchaseorder_document">
    <xpath expr="//t[@t-call='web.external_layout']" position="replace">
        <div class="page" style="margin-top:-10px">
            <div class="oe_structure"/>
            <div id="client_copy">
                  
            <table style="width: 100% !important; border: 0px">
                <tbody style="border: 0px">
                  <tr style="border: 0px">
                    <td class="text_right mt-4" style="width:80%;">
                     
                      <strong><span t-field="o.partner_id.name"/></strong> <br/>
                      <span t-field="o.partner_id.country_id"/> <br/>
                      <br/>
                    </td>
                    <td/>
                    <td/>
                    <td/>
                    <td name="td_date" class="text_end">
                      <strong class="text_end">Date: <span t-esc="o.date_order.strftime('%d-%m-%Y')"/></strong> <br/>
                      <br/>
                    </td>
                  </tr>
                </tbody>
              </table>
              
            <table class="mytable mytable-head" style="width: 100% !important">
                <thead>
                    <tr style="font-size: 16px; padding: 3px !important">
                        <th name="th_number" style="width: 5%; padding: 8px !important;" class="text-center"><strong>#</strong></th>
                        <th name="th_gross_weight" style="width: 19%; padding: 8px !important" class="text-center"><strong>Qty <br/>(GMS)</strong></th>
                        <th name="th_product_qty" style="width: 19%; padding: 8px !important" class="text-center"><strong>Qty <br/>(Tolas)</strong></th>
                        <th name="th_x_factor" style="width: 19%; padding: 8px !important" class="text-center"><strong>Tola <br/> Rate</strong></th>
                        <th name="th_product_quality" style="width: 19%; padding: 8px !important" class="text-center"><strong>Purity <br/>%</strong></th>
                        <th name="th_price_subtotal" style="width: 19%; padding: 8px !important" class="text-center"><strong>USD <br/> $</strong></th>
                    </tr>
                </thead>
              <tbody>
    <t t-foreach="enumerate(o.order_line, 1)" t-as="line">
        <tr>
            <t t-if="not line[1].display_type">
                <!-- Only display the line if either product_quality or manual_product_quality is greater than 0 -->
                <t t-if="line[1].product_quality &gt; 0 or line[1].manual_product_quality &gt; 0">
                    <td id="product" style="width: 5%;  padding: 8px !important;  margin-left:10px;" class="text-center">
                        <span style="padding-left:2%" t-esc="line[0]"/>
                    </td>
                    <t t-if="line[1].manual_first_process &gt; 0">
                        <td id="product" style="width: 19%; padding: 8px !important;  padding-left:50px;">
                            <span class="text-center" style="padding-left:35%" t-esc="'%.2f'%(line[1].manual_first_process)"/>
                        </td>
                    </t>
                    <t t-if="line[1].manual_first_process == 0">
                        <td id="product" style="width: 19%; padding: 8px !important" class="text-center">
                            <span class="text-center" style="padding-left:35%" t-esc="'%.2f'%(line[1].first_process_wt)"/>
                        </td>
                    </t>
                    <td id="product" style="width: 19%; padding: 8px !important" class="text-center">
                        <span class="text-center" style="padding-left:35%" t-esc="'%.2f'%(line[1].product_qty)"/>
                    </td>
                    <td id="product" style="width: 19%; padding: 8px !important" class="text-center">
                         <span class="text-center" style="padding-left:40%" t-esc="'{:,.2f}'.format(o.transaction_price_per_unit)"/>
                    </td>
                    <t t-if="line[1].manual_product_quality &gt; 0">
                        <td id="product" style="width: 19%; padding: 8px !important" class="text-center">
                            <span class="text-center" style="padding-left:35%" t-esc="'%.2f'%(line[1].manual_product_quality)"/>
                        </td>
                    </t>
                    <t t-if="line[1].manual_product_quality == 0">
                        <td id="product" style="width: 19%; padding: 8px !important" class="text-center">
                            <span class="text-center" style="padding-left:40%" t-esc="'%.2f'%(line[1].product_quality)"/>
                        </td>
                    </t>
                    <td style="width: 19%; padding: 8px !important" class="text-center">
                      <span class="text-center" style="padding-left:30%" t-esc="'{:,.2f}'.format(line[1].price_subtotal)"/>
                    </td>
                </t>
            </t>
            <t t-else="">
                <td colspan="99" id="section">
                    <span t-field="line[1].name"/>
                </td>
            </t>
        </tr>
    </t>
</tbody>

            </table>
         <table style="width: 100% !important; border: 0px; margin-top:20px">
         <tbody style="border: 0px">
          <!-- Calculate the total subtotal in UGX -->
          <t t-set="total_custom_currency" t-value="sum(line.currency_id._convert(line.price_subtotal, line.UGX_currency, o.company_id, o.date_order or fields.Date.today()) for line in o.order_line if (line.product_quality &gt; 0 or line.manual_product_quality &gt; 0))"/>
          <!-- Calculate the total subtotal in USD -->
          <t t-set="total_usd" t-value="sum(line.price_subtotal for line in o.order_line if (line.product_quality &gt; 0 or line.manual_product_quality &gt; 0))"/>
          <!-- Display the totals -->
          <tr style="border: 0px">
              <td class="text_right" style="width: 50% !important; line-height: 30px; margin: 0px !important; border: 0px !important;">
                  <span>Total</span>
              </td>
              <td name="td_amount_untaxed" class="text_end" style="margin: 0px !important; line-height: 30px; width: 15% !important; border: 0px !important;">
                  <strong>
                      USD <span style="padding-left:40px;">$ <t t-esc="'{:,.2f}'.format(total_usd)"/></span>
                  </strong>
                  <br/>
                  <strong>
                      UGX <span style="padding-left:40px;"><t t-esc="'{:,.0f}'.format(total_custom_currency)"/></span>
                  </strong>
              </td>
          </tr>
      </tbody>

  </table>



            </div>
           
                      <!--Company Copy-->
            <div id="company_copy" class="mt-5" style="margin-top: 400px;">
               <table style="width: 100% !important; border: 0px">
                <tbody style="border: 0px">
                  <tr style="border: 0px">
                    <td class="text_right" style="width:80%;">
                     
                      <strong><span t-field="o.partner_id.name"/></strong> <br/>
                      <span t-field="o.partner_id.country_id"/> <br/>
                      <br/>
                    </td>
                    <td/>
                    <td/>
                    <td/>
  
                    <td name="td_date" class="text_right">
                      <strong>Date: <span t-esc="o.date_order.strftime('%d-%m-%Y')"/></strong> <br/>
                      <strong>PO: #<span t-field="o.name"/></strong> <br/>
                      <br/>
                    </td>
                  </tr>
                </tbody>
              </table>

            <table class="mytable mytable-head" style="width: 100% !important">
                <thead>
                    <tr style="font-size: 16px; padding: 3px !important">
                        <th name="th_product" style="width: 10%;  padding: 8px !important;  margin-left:10px;"><strong>Item</strong></th>
                        <th name="th_gross_weight" style="width: 18%;  padding: 8px !important;  margin-left:10px;"><strong>Grams</strong></th>
                        <th name="th_product_qty" style="width: 18%;  padding: 8px !important;  margin-left:10px;"><strong>Tolas</strong></th>
                        <th name="th_x_factor" style="width: 18%;  padding: 8px !important;  margin-left:10px;"><strong>Rate</strong></th>
                        <th name="th_product_quality" style="width: 18%;  padding: 8px !important;  margin-left:10px;" class="text-center"><strong>Purity <br/>%</strong></th>
                        <th name="th_price_subtotal" style="width: 18%;  padding: 8px !important;  margin-left:10px;" class="text-center"><strong>Subtotal <br/>$</strong></th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="o.order_line" t-as="order_line">
                        <tr t-att-class="'bg-200 fw-bold o_line_section' if order_line.display_type == 'line_section' else 'fst-italic o_line_note' if order_line.display_type == 'line_note' else ''">
                            <t t-if="not order_line.display_type">
                                <td id="product" style="width: 10%;  padding: 8px !important;  margin-left:10px;">
                                    <span class="text-center" style="padding-left:35%" t-field="order_line.name"/>
                                </td>
                                
                                 <t t-if="order_line.manual_first_process &gt; 0">
                                        <td id="product" style="width: 18%;  padding: 8px !important;  margin-left:10px;">
                                        <span class="text-center" style="padding-left:35%" t-field="order_line.manual_first_process"/>
                                    </td>
                                    </t>
                                    <t t-if="order_line.manual_first_process == 0">
                                        <td id="product" style="width: 18%;  padding: 8px !important;  margin-left:10px;">
                                      <span class="text-center" style="padding-left:35%" t-field="order_line.first_process_wt"/>
                                    </td>
                                    </t>
                                 <td id="product" style="width: 18%;  padding: 8px !important;  margin-left:10px;">
                                     <span class="text-center" style="padding-left:35%" t-field="order_line.product_qty"/>
                                </td>
                                <td id="product" style="width: 18%;  padding: 8px !important;  margin-left:10px;">
                                    <span class="text-center" style="padding-left:35%" t-raw="o.transaction_price_per_unit"/>
                                </td>
                                
                                <t t-if="order_line.manual_product_quality &gt; 0">
                                        <td id="product" style="width: 18%;  padding: 8px !important;  margin-left:10px;">
                                        <span class="text-center" style="padding-left:35%" t-field="order_line.manual_product_quality"/>
                                    </td>
                                    </t>
                                <t t-if="order_line.manual_product_quality == 0">
                                        <td id="product" style="width: 18%;  padding: 8px !important;  margin-left:10px;">
                                      <span class="text-center" style="padding-left:35%" t-field="order_line.product_quality"/>
                                    </td>
                                    </t>
                                <td class="text-center" style="width: 18%;  padding: 8px !important;  margin-left:10px;">
                                   
                                     <span class="text-center" style="padding-left:30%" t-raw="order_line.price_subtotal"/>
                                </td>
                            </t>
                            <t t-else="">
                                <td colspan="99" id="section">
                                    <span t-field="order_line.name"/>
                                </td>
                            </t>
                        </tr>
                    </t>
                </tbody>
            </table>
              
            </div>
  

            <p t-field="o.notes" class="mt-4"/>

            <div class="oe_structure"/>
        </div>
    </xpath>

</data>